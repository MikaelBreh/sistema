<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listagem de Pedidos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .tabs {
            display: flex;
            border-bottom: 2px solid #ccc;
            margin-bottom: 20px;
        }
        .tabs a {
            padding: 10px 20px;
            cursor: pointer;
            text-decoration: none;
            color: black;
            border: 1px solid #ccc;
            border-bottom: none;
            background-color: #f9f9f9;
        }
        .tabs a.active {
            background-color: white;
            border-top: 2px solid #007bff;
            font-weight: bold;
        }
        .tabs a:hover {
            background-color: #f1f1f1;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 15px;
            border: 1px solid #ccc;
            text-align: left;
        }
        th {
            background-color: #f9f9f9;
        }
        tbody tr:nth-child(odd) {
            background-color: #f9f9f9;
        }
        tbody tr:nth-child(even) {
            background-color: #fff;
        }

        /* Estilos para o carregamento */
        #loading {
            display: none;  /* Inicialmente escondido */
            text-align: center;
            margin: 20px 0;
        }
        #loading img {
            width: 50px;
        }
    </style>
</head>
<body>

    <div class="tabs">
        <a href="#" class="active" data-status="em_aberto">Em Aberto</a>
        <a href="#" data-status="aprovados">Aprovados</a>
        <a href="#" data-status="separando">Separando</a>
        <a href="#" data-status="separacao_finalizada">Separação Finalizada</a>
        <a href="#" data-status="finalizados">Finalizados</a>
        <a href="#" data-status="cancelado">Cancelado</a>
    </div>

    <!-- Elemento de carregamento -->
    <div id="loading">
        <img src="https://i.gifer.com/YCZH.gif" alt="Carregando...">
        <p>Carregando...</p>
    </div>

    <table>
        <thead>
            <tr>
                <th>Número do Pedido</th>
                <th>Cliente</th>
                <th>Data</th>
            </tr>
        </thead>
        <tbody id="tabela-pedidos">
            <!-- Linhas serão carregadas via JS -->
        </tbody>
    </table>

   <script>
    document.addEventListener('DOMContentLoaded', function () {
        const tabs = document.querySelectorAll('.tabs a');
        const tabelaPedidos = document.getElementById('tabela-pedidos');
        const loading = document.getElementById('loading');  // Referência ao elemento de carregamento

        // Carrega os pedidos da aba ativa na inicialização
        carregarPedidos('em_aberto');

        tabs.forEach(tab => {
            tab.addEventListener('click', function (e) {
                e.preventDefault();

                // Remove classe active de todas as abas
                tabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');  // Adiciona classe active na aba clicada

                // Carrega os pedidos correspondentes ao status
                const status = this.getAttribute('data-status');
                carregarPedidos(status);
            });
        });

        function carregarPedidos(status) {
            // Mostra o elemento de carregamento
            loading.style.display = 'block';

            // Construindo a URL correta usando Django template
            const url = '' + status;

            // Fazendo requisição AJAX
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    tabelaPedidos.innerHTML = '';  // Limpa a tabela antes de inserir os novos dados
                    data.pedidos.forEach(pedido => {
                        const row = `<tr>
                            <td>${pedido.numero_pedido}</td>
                            <td>${pedido.cliente}</td>
                            <td>${pedido.data}</td>
                        </tr>`;
                        tabelaPedidos.insertAdjacentHTML('beforeend', row);
                    });

                    // Esconde o elemento de carregamento após a conclusão
                    loading.style.display = 'none';
                })
                .catch(error => {
                    console.error('Erro ao carregar pedidos:', error);
                    // Esconde o elemento de carregamento mesmo se houver um erro
                    loading.style.display = 'none';
                });
        }
    });
</script>

</body>
</html>
